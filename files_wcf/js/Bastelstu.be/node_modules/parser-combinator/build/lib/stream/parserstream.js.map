{"version":3,"sources":["../../../src/lib/stream/parserstream.js"],"names":["ParserStream","parser","source","input","offsets","index","location","getOffset","endOfStream","result","parse","isAccepted","offset","value","Error","factory"],"mappings":";;;;;;;;AAQA;;;;;;;;;;+eARA;;;;;;;;AAUA;;;IAGMA,Y;;;AACF,0BAAYC,MAAZ,EAAoBC,MAApB,EAA4B;AAAA;;AAAA;;AAExB,cAAKA,MAAL,GAAcD,MAAd;AACA,cAAKE,KAAL,GAAaD,MAAb;AACA,cAAKE,OAAL,GAAe,EAAf;AAJwB;AAK3B;;;;kCAESC,K,EAAO;AACb,mBAAO,KAAKD,OAAL,CAAaC,KAAb,KAAuBA,KAA9B;AACH;;AAED;;;;iCACSA,K,EAAO;AACZ,mBAAO,KAAKF,KAAL,CAAWG,QAAX,CAAoB,KAAKC,SAAL,CAAeF,QAAQ,CAAvB,IAA4B,CAAhD,CAAP;AACH;;AAED;;;;oCACYA,K,EAAO;AACf,mBAAO,KAAKF,KAAL,CAAWK,WAAX,CAAuB,KAAKD,SAAL,CAAeF,KAAf,CAAvB,CAAP;AACH;;AAED;;;;kCACUA,K,EAAO;AACb,gBAAII,SAAS,KAAKP,MAAL,CAAYQ,KAAZ,CAAkB,KAAKP,KAAvB,EAA8B,KAAKI,SAAL,CAAeF,KAAf,CAA9B,CAAb;;AAEA,gBAAII,OAAOE,UAAP,EAAJ,EAAyB;AACrB,qBAAKP,OAAL,CAAaC,QAAQ,CAArB,IAA0BI,OAAOG,MAAjC;AACA,uBAAOH,OAAOI,KAAd;AACH,aAHD,MAGO;AACH,sBAAM,IAAIC,KAAJ,EAAN;AACH;AACJ;;;;;;AAGL,SAASC,OAAT,CAAiBd,MAAjB,EAAyBC,MAAzB,EAAiC;AAC7B,WAAO,IAAIF,YAAJ,CAAiBC,MAAjB,EAAyBC,MAAzB,CAAP;AACH;;kBAEca,O","file":"parserstream.js","sourcesContent":["/*\r\n * Parsec\r\n * https://github.com/d-plaindoux/parsec\r\n *\r\n * Copyright (c) 2016 Didier Plaindoux\r\n * Licensed under the LGPL2 license.\r\n */\r\n\r\nimport Stream from './stream';\r\n\r\n/**\r\n * ParserStream stream class\r\n */\r\nclass ParserStream extends Stream {\r\n    constructor(parser, source) {\r\n        super();\r\n        this.source = parser;\r\n        this.input = source;\r\n        this.offsets = {};\r\n    }\r\n\r\n    getOffset(index) {\r\n        return this.offsets[index] || index;\r\n    }\r\n\r\n    // Stream 'a => number -> number\r\n    location(index) {\r\n        return this.input.location(this.getOffset(index - 1) + 1);\r\n    }\r\n\r\n    // ParserStream 'a => unit -> boolean\r\n    endOfStream(index) {\r\n        return this.input.endOfStream(this.getOffset(index));\r\n    }\r\n\r\n    // ParserStream 'a => number -> 'a <+> error\r\n    unsafeGet(index) {\r\n        var result = this.source.parse(this.input, this.getOffset(index));\r\n\r\n        if (result.isAccepted()) {\r\n            this.offsets[index + 1] = result.offset;\r\n            return result.value;\r\n        } else {\r\n            throw new Error();\r\n        }\r\n    }\r\n}\r\n\r\nfunction factory(parser, source) {\r\n    return new ParserStream(parser, source);\r\n}\r\n\r\nexport default factory;\r\n"]}